<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Government Payroll System</title>

<style>
body{
font-family:'Segoe UI',sans-serif;
margin:0;
background:linear-gradient(135deg,#1f4fa8,#2d6cdf);
}

.container{
width:1100px;
margin:40px auto;
background:white;
border-radius:15px;
padding:30px;
box-shadow:0 15px 40px rgba(0,0,0,0.2);
}

h1{
text-align:center;
color:#1f4fa8;
margin-bottom:30px;
}

.nav{
text-align:center;
margin-bottom:25px;
}

.nav button{
background:#1f4fa8;
color:white;
padding:10px 18px;
margin:5px;
border:none;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}

.nav button:hover{
background:#163a7a;
}

input,select{
padding:8px;
width:280px;
margin:5px 0;
border-radius:6px;
border:1px solid #ccc;
}

button.primary{
background:#2d6cdf;
}

button.danger{
background:#d63031;
}

table{
width:100%;
border-collapse:collapse;
margin-top:20px;
}

th,td{
border:1px solid #ccc;
padding:10px;
text-align:center;
}

th{
background:#f4f6f9;
}

section{display:none;}

.payslip{
margin-top:30px;
border:2px solid black;
padding:20px;
}

.payslip-header{
text-align:center;
font-weight:bold;
}

</style>
</head>
<body>

<div class="container">

<h1>Government Payroll System</h1>

<div id="authSection">
<h3>Login</h3>
<input type="email" id="email" placeholder="Email"><br>
<input type="password" id="password" placeholder="Password"><br>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
</div>

<div id="appSection" style="display:none;">

<div class="nav">
<button onclick="show('employee')">Employees</button>
<button onclick="show('payroll')">Payroll</button>
<button onclick="show('records')">Records</button>
<button onclick="logout()">Logout</button>
</div>

<section id="employee">
<h3>Add Employee</h3>
<input id="empName" placeholder="Name"><br>
<input id="empOffice" placeholder="Office"><br>
<input id="empSalary" type="number" placeholder="Monthly Salary"><br>
<button onclick="addEmployee()">Save</button>

<table>
<thead>
<tr><th>Name</th><th>Office</th><th>Salary</th></tr>
</thead>
<tbody id="empTable"></tbody>
</table>
</section>

<section id="payroll">
<h3>Create Payroll</h3>
<select id="payrollEmp"></select><br>
<input id="daysWorked" type="number" placeholder="Days Worked"><br>
<input id="sss" type="number" placeholder="SSS"><br>
<input id="tax" type="number" placeholder="Tax %"><br>
<button onclick="computePayroll()">Compute & Save</button>
</section>

<section id="records">
<h3>Monthly Payslip</h3>
<select id="recordEmp"></select><br>
<button onclick="generatePayslip()">Generate</button>

<div id="payslipOutput"></div>
</section>

</div>
</div>

<script type="module">

// ðŸ”¥ FIREBASE IMPORT
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¥ YOUR FIREBASE CONFIG HERE
const firebaseConfig = {
apiKey: "YOUR_API_KEY",
authDomain: "YOUR_AUTH_DOMAIN",
projectId: "YOUR_PROJECT_ID",
storageBucket: "YOUR_BUCKET",
messagingSenderId: "YOUR_ID",
appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

// AUTH
window.register = async function(){
await createUserWithEmailAndPassword(auth,email.value,password.value);
alert("Registered!");
}

window.login = async function(){
await signInWithEmailAndPassword(auth,email.value,password.value);
}

window.logout = async function(){
await signOut(auth);
}

onAuthStateChanged(auth,(user)=>{
if(user){
currentUser=user;
authSection.style.display="none";
appSection.style.display="block";
loadEmployees();
}
});

// SHOW SECTION
window.show=function(id){
document.querySelectorAll("section").forEach(s=>s.style.display="none");
document.getElementById(id).style.display="block";
}

// ADD EMPLOYEE
window.addEmployee=async function(){
await addDoc(collection(db,"users",currentUser.uid,"employees"),{
name:empName.value,
office:empOffice.value,
salary:Number(empSalary.value)
});
alert("Saved!");
loadEmployees();
}

// LOAD EMPLOYEES
async function loadEmployees(){
empTable.innerHTML="";
let snap=await getDocs(collection(db,"users",currentUser.uid,"employees"));
snap.forEach(doc=>{
let d=doc.data();
empTable.innerHTML+=`<tr><td>${d.name}</td><td>${d.office}</td><td>${d.salary}</td></tr>`;
});
}

// COMPUTE PAYROLL
window.computePayroll=async function(){
let snap=await getDocs(collection(db,"users",currentUser.uid,"employees"));
let empData;
snap.forEach(doc=>{
if(doc.data().name==payrollEmp.value){
empData=doc.data();
}
});
let gross=(empData.salary/22)*daysWorked.value;
let phil=gross*0.05;
let net=gross-phil-Number(sss.value)-(gross*(tax.value/100));

await addDoc(collection(db,"users",currentUser.uid,"payrolls"),{
name:empData.name,
gross,phil,sss:Number(sss.value),tax:Number(tax.value),net
});
alert("Payroll Saved!");
}

// GENERATE PAYSLIP
window.generatePayslip=async function(){
let snap=await getDocs(collection(db,"users",currentUser.uid,"payrolls"));
let html="";
snap.forEach(doc=>{
let d=doc.data();
if(d.name==recordEmp.value){
html+=`
<div class="payslip">
<div class="payslip-header">
Republic of the Philippines<br>
OFFICIAL PAYSLIP
</div>
<hr>
Gross: â‚±${d.gross}<br>
PhilHealth: â‚±${d.phil}<br>
SSS: â‚±${d.sss}<br>
Tax: ${d.tax}%<br>
Net: â‚±${d.net}
</div>
`;
}
});
payslipOutput.innerHTML=html;
}

</script>
</body>
</html>
