<!DOCTYPE html>
<html>
<head>
<meta charset="UTFâ€‘8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enterprise Payroll System</title>
<style>
body{margin:0;font-family:Segoe UI;background:#eef1f7;}
.top-header{text-align:center;background:#0d47a1;color:white;padding:20px;}
.top-header h3{margin:0;font-size:20px;}
.top-header h4{margin:5px 0 0 0;font-size:16px;font-weight:normal;}
header{background:#0d47a1;color:white;padding:15px;display:flex;justify-content:space-between;}
.sidebar{width:230px;background:#1565c0;min-height:100vh;padding:20px;}
.sidebar button{width:100%;padding:10px;margin-bottom:10px;border:none;border-radius:6px;background:white;color:#1565c0;font-weight:bold;cursor:pointer;}
.container{display:flex;}
.content{flex:1;padding:30px;}
.card{background:white;padding:25px;border-radius:10px;margin-bottom:25px;}
input,select{width:100%;padding:8px;margin-bottom:12px;border-radius:6px;border:1px solid #ccc;}
button.action{background:#0d47a1;color:white;border:none;padding:10px;border-radius:6px;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:#0d47a1;color:white;}
.hidden{display:none;}
.login-box{max-width:400px;margin:120px auto;background:white;padding:30px;border-radius:10px;}
</style>
</head>
<body>

<!-- TOP HEADER -->
<div class="top-header">
  <h3>DEPARTMENT OF SCIENCE AND TECHNOLOGY REGIONAL OFFICE NO. 02</h3>
  <h4>FINANCE ADMINISTRATIVE SUPPORT SERVICES</h4>
</div>

<!-- LOGIN -->
<div id="loginSection" class="login-box">
<h3>Login</h3>
<input type="email" id="email" placeholder="User Account">
<input type="password" id="password" placeholder="Password">
<button class="action" id="loginBtn">Login</button>
<p id="loginError" style="color:red;"></p>
</div>

<!-- MAIN APP -->
<div id="appSection" class="hidden">

<header>
<h2>ADVANCE PAYROLL AND PAYSLIP SYSTEM</h2>
<button class="action" id="logoutBtn">Logout</button>
</header>

<div class="container">

<div class="sidebar">
<button onclick="showSection('library')">Library Files</button>
<button onclick="showSection('payroll')">Payroll Transaction</button>
<button onclick="showSection('usermanagement')">User Management</button>
<button onclick="showSection('payslip')">Generate Pay Slip</button>
</div>

<div class="content">

<!-- EMPLOYEE -->
<div id="library" class="card">
<h3>Add Employee</h3>
<input type="text" id="empName" placeholder="Employee Name">
<input type="text" id="empPosition" placeholder="Position">
<input type="number" id="empSalary" placeholder="Monthly Salary">
<input type="number" id="empSSS" placeholder="SSS">
<input type="number" id="empPagibigSavings" placeholder="Pagibig Savings">
<input type="number" id="empPagibigMPL" placeholder="Pagibig MPL">
<input type="number" id="empPagibigMP2" placeholder="Pagibig MP2">
<input type="number" id="empPhilhealth" placeholder="Philhealth (Auto 5%)" readonly>
<button class="action" id="saveEmployeeBtn">Save Employee</button>
<table>
<thead>
<tr><th>Name</th><th>Position</th><th>Salary</th><th>SSS</th><th>Pagibig Savings</th><th>Pagibig MPL</th><th>Pagibig MP2</th><th>Philhealth</th></tr>
</thead>
<tbody id="employeeTable"></tbody>
</table>
</div>

<!-- PAYROLL -->
<div id="payroll" class="card hidden">
<h3>Payroll Transaction</h3>
<select id="empSelect"></select>
<input type="text" id="position" readonly>
<input type="number" id="salary" readonly>
<select id="monthSelect">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select>
<select id="yearSelect"></select>
<input type="number" id="cutoffSalary" placeholder="Cutoff Salary" readonly>
<input type="number" id="daysWorked" placeholder="Days Worked">
<button class="action" id="savePayrollBtn">Save Payroll</button>
<table>
<thead>
<tr><th>Name</th><th>Month</th><th>Year</th><th>Days Worked</th></tr>
</thead>
<tbody id="payrollTable"></tbody>
</table>
</div>

<!-- USER MANAGEMENT -->
<div id="usermanagement" class="card hidden">
<h3>User Management</h3>
<input type="text" id="newUserName" placeholder="User Name">
<input type="email" id="newUserEmail" placeholder="User Account">
<input type="password" id="newUserPassword" placeholder="Password">
<select id="newUserRole"><option value="admin">Admin</option><option value="staff">Staff</option></select>
<button class="action" id="createUserBtn">Create User</button>
<table>
<thead><tr><th>Name</th><th>Email</th><th>Role</th></tr></thead>
<tbody id="userTable"></tbody>
</table>
</div>

<!-- PAY SLIP -->
<div id="payslip" class="card hidden">
<h3>Generate Pay Slip</h3>
<select id="payslipEmpSelect"></select>
<select id="payslipMonthSelect">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select>
<select id="payslipYearSelect"></select>
<button class="action" id="generatePayslipBtn">Generate Pay Slip</button>

<div id="payslipResult" class="hidden">
<table style="width:100%;border:1px solid #000;border-collapse:collapse;">
<thead>
<tr><th colspan="2" style="text-align:center;font-size:16px;">DEPARTMENT OF SCIENCE AND TECHNOLOGY REGION 02</th></tr>
<tr><td>Employee Name:</td><td id="psEmpName"></td></tr>
<tr><td>Month:</td><td id="psMonth"></td></tr>
<tr><td>Year:</td><td id="psYear"></td></tr>
<tr><td>Total Days Worked:</td><td id="psDaysWorked"></td></tr>
</thead>
<tbody>
<tr><td>Gross Pay</td><td id="psGross"></td></tr>
<tr><td>Total Deduction</td><td id="psTotalDed"></td></tr>
<tr><td>Net Pay</td><td id="psNet"></td></tr>
</tbody>
</table>
</div>
</div>

</div></div></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyCDhTfNVO5jTqredgHe9t7emxOlvGMczxM",
  authDomain: "enterprise-payroll-2026.firebaseapp.com",
  projectId: "enterprise-payroll-2026",
  storageBucket: "enterprise-payroll-2026.firebasestorage.app",
  messagingSenderId: "877928180953",
  appId: "1:877928180953:web:3b09060848347031c1e2c8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ELEMENTS */
const loginSection = document.getElementById("loginSection");
const appSection = document.getElementById("appSection");
const loginBtn = document.getElementById("loginBtn");
const email = document.getElementById("email");
const password = document.getElementById("password");
const loginError = document.getElementById("loginError");
const logoutBtn = document.getElementById("logoutBtn");

const empName = document.getElementById("empName");
const empPosition = document.getElementById("empPosition");
const empSalary = document.getElementById("empSalary");
const empSSS = document.getElementById("empSSS");
const empPagibigSavings = document.getElementById("empPagibigSavings");
const empPagibigMPL = document.getElementById("empPagibigMPL");
const empPagibigMP2 = document.getElementById("empPagibigMP2");
const empPhilhealth = document.getElementById("empPhilhealth");
const saveEmployeeBtn = document.getElementById("saveEmployeeBtn");
const employeeTable = document.getElementById("employeeTable");

const empSelect = document.getElementById("empSelect");
const position = document.getElementById("position");
const salary = document.getElementById("salary");
const monthSelect = document.getElementById("monthSelect");
const yearSelect = document.getElementById("yearSelect");
const cutoffSalary = document.getElementById("cutoffSalary");
const daysWorked = document.getElementById("daysWorked");
const savePayrollBtn = document.getElementById("savePayrollBtn");
const payrollTable = document.getElementById("payrollTable");

const newUserName = document.getElementById("newUserName");
const newUserEmail = document.getElementById("newUserEmail");
const newUserPassword = document.getElementById("newUserPassword");
const newUserRole = document.getElementById("newUserRole");
const createUserBtn = document.getElementById("createUserBtn");
const userTable = document.getElementById("userTable");

const payslipEmpSelect = document.getElementById("payslipEmpSelect");
const payslipMonthSelect = document.getElementById("payslipMonthSelect");
const payslipYearSelect = document.getElementById("payslipYearSelect");
const generatePayslipBtn = document.getElementById("generatePayslipBtn");

const psEmpName = document.getElementById("psEmpName");
const psMonth = document.getElementById("psMonth");
const psYear = document.getElementById("psYear");
const psDaysWorked = document.getElementById("psDaysWorked");
const psGross = document.getElementById("psGross");
const psTotalDed = document.getElementById("psTotalDed");
const psNet = document.getElementById("psNet");

/* AUTH */
loginBtn.onclick = async()=>{
  try {
    await signInWithEmailAndPassword(auth,email.value,password.value);
    loginError.textContent="";
  } catch(e) {
    loginError.textContent=e.message;
  }
};

logoutBtn.onclick = ()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  if(user) {
    loginSection.classList.add("hidden");
    appSection.classList.remove("hidden");
    initializeAppData();
  } else {
    loginSection.classList.remove("hidden");
    appSection.classList.add("hidden");
  }
});

/* INITIALIZE */
async function initializeAppData() {
  loadEmployees();
  loadPayrolls();
  loadPayslipEmployees();
}

/* ADD EMPLOYEE */
saveEmployeeBtn.onclick = async ()=>{
  await addDoc(collection(db,"employees"),{
    name:empName.value,
    position:empPosition.value,
    salary:parseFloat(empSalary.value),
    sss:parseFloat(empSSS.value)||0,
    pagibigSavings:parseFloat(empPagibigSavings.value)||0,
    pagibigMPL:parseFloat(empPagibigMPL.value)||0,
    pagibigMP2:parseFloat(empPagibigMP2.value)||0,
    philhealth:parseFloat(empPhilhealth.value)||0
  });
  loadEmployees();
};

/* LOAD EMPLOYEES */
async function loadEmployees(){
  const snap = await getDocs(collection(db,"employees"));
  employeeTable.innerHTML="";
  empSelect.innerHTML="";
  payslipEmpSelect.innerHTML="";
  snap.forEach(doc=>{
    const d = doc.data();
    const tr = `<tr><td>${d.name}</td><td>${d.position}</td><td>${d.salary}</td><td>${d.sss}</td><td>${d.pagibigSavings}</td><td>${d.pagibigMPL}</td><td>${d.pagibigMP2}</td><td>${d.philhealth}</td></tr>`;
    employeeTable.innerHTML+=tr;
    empSelect.innerHTML+=`<option value="${d.name}|${d.salary}|${d.sss}|${d.philhealth}|${d.pagibigSavings}|${d.pagibigMPL}|${d.pagibigMP2}">${d.name}</option>`;
    payslipEmpSelect.innerHTML+=`<option value="${d.name}">${d.name}</option>`;
  });
}

/* PAYROLL */
empSelect.onchange=()=>{
  const parts = empSelect.value.split("|");
  position.value=parts[0];
  salary.value=parts[1];
  cutoffSalary.value=(parseFloat(parts[1])/2).toFixed(2);
  sss.value=parts[2];
  philhealth.value=parts[3];
  pagibigSavings.value=parts[4];
  pagibigMPL.value=parts[5];
  pagibigMP2.value=parts[6];
};

savePayrollBtn.onclick=async()=>{
  await addDoc(collection(db,"payrolls"),{
    name:empSelect.value.split("|")[0],
    month:monthSelect.value,
    year:payslipYearSelect.value,
    daysWorked:parseFloat(daysWorked.value)
  });
  loadPayrolls();
};

/* LOAD PAYROLLS */
async function loadPayrolls(){
  const snap = await getDocs(collection(db,"payrolls"));
  payrollTable.innerHTML="";
  snap.forEach(doc=>{
    const d = doc.data();
    payrollTable.innerHTML+=`<tr><td>${d.name}</td><td>${d.month}</td><td>${d.year}</td><td>${d.daysWorked}</td></tr>`;
  });
}

/* GENERATE PAY SLIP */
generatePayslipBtn.onclick = async()=>{
  const name = payslipEmpSelect.value;
  const month = payslipMonthSelect.value;
  const year = payslipYearSelect.value;

  const snap = await getDocs(collection(db,"payrolls"));
  let totalDays=0;
  snap.forEach(doc=>{
    const d = doc.data();
    if(d.name === name && d.month === month && d.year === year) totalDays += d.daysWorked;
  });

  psEmpName.textContent=name;
  psMonth.textContent=month;
  psYear.textContent=year;
  psDaysWorked.textContent=totalDays;

  const gross = (parseFloat(salary.value)/2)/11 * totalDays;
  const totalDed = 0; // you can add actual deduction fields later
  const net = gross - totalDed;

  psGross.textContent=gross.toFixed(2);
  psTotalDed.textContent=totalDed.toFixed(2);
  psNet.textContent=net.toFixed(2);

  document.getElementById("payslipResult").classList.remove("hidden");
};

/* SHOW SECTION */
window.showSection=id=>{
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};
</script>
</body>
</html>
