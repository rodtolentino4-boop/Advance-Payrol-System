<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enterprise Payroll System</title>

<!-- Libraries -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family:Segoe UI, sans-serif; margin:0; background:#f4f6f9; }
.box { max-width:500px; margin:50px auto; background:white; padding:25px; border-radius:10px; box-shadow:0 10px 20px rgba(0,0,0,0.2);}
input,select,button { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #ccc; }
button { background:#1565c0; color:white; cursor:pointer; border:none; }
button:hover{opacity:0.9;}
.hidden{display:none;}
table { width:100%; border-collapse:collapse; margin-top:15px; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#1565c0; color:white; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="box">
<h2>Login</h2>
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button id="loginBtn">Login</button>
<p id="loginError" style="color:red;"></p>
</div>

<!-- ADD EMPLOYEE -->
<div id="employeeBox" class="box hidden">
<h2>Add Employee</h2>
<input type="text" id="empName" placeholder="Employee Name">
<input type="text" id="empPosition" placeholder="Position">
<input type="number" id="empSalary" placeholder="Salary">
<button id="addEmployeeBtn">Add Employee</button>
</div>

<!-- ADD PAYROLL -->
<div id="payrollBox" class="box hidden">
<h2>Add Payroll</h2>
<select id="empSelect"></select>
<select id="monthSelect">
<option>January</option><option>February</option><option>March</option>
<option>April</option><option>May</option><option>June</option>
<option>July</option><option>August</option><option>September</option>
<option>October</option><option>November</option><option>December</option>
</select>
<input type="number" id="grossPay" placeholder="Gross Pay">
<input type="number" id="deduction" placeholder="Deduction">
<button id="addPayrollBtn">Save Payroll</button>
</div>

<!-- PAYSLIP / RECORDS -->
<div id="payslipBox" class="box hidden">
<h2>Payroll Records</h2>
<table id="payrollTable">
<thead>
<tr><th>Name</th><th>Month</th><th>Gross</th><th>Deduction</th><th>Net</th><th>Action</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// --- Firebase Config ---
const firebaseConfig = {
apiKey:"YOUR_API_KEY",
authDomain:"YOUR_AUTH_DOMAIN",
projectId:"YOUR_PROJECT_ID",
appId:"YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- DOM Elements ---
const loginBox=document.getElementById("loginBox");
const employeeBox=document.getElementById("employeeBox");
const payrollBox=document.getElementById("payrollBox");
const payslipBox=document.getElementById("payslipBox");

const email=document.getElementById("email");
const password=document.getElementById("password");
const loginBtn=document.getElementById("loginBtn");
const loginError=document.getElementById("loginError");

const empName=document.getElementById("empName");
const empPosition=document.getElementById("empPosition");
const empSalary=document.getElementById("empSalary");
const addEmployeeBtn=document.getElementById("addEmployeeBtn");

const empSelect=document.getElementById("empSelect");
const monthSelect=document.getElementById("monthSelect");
const grossPay=document.getElementById("grossPay");
const deduction=document.getElementById("deduction");
const addPayrollBtn=document.getElementById("addPayrollBtn");

const payrollTable=document.querySelector("#payrollTable tbody");

let employees=[], payrolls=[];

// --- Auth Listener ---
onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    employeeBox.classList.remove("hidden");
  }else{
    loginBox.classList.remove("hidden");
    employeeBox.classList.add("hidden");
  }
});

// --- Login ---
loginBtn.addEventListener("click", async ()=>{
  loginError.innerText="";
  try{
    await signInWithEmailAndPassword(auth,email.value,password.value);
  }catch(e){
    loginError.innerText=e.message;
  }
});

// --- Add Employee ---
addEmployeeBtn.addEventListener("click", async ()=>{
  if(!empName.value || !empPosition.value || !empSalary.value){ alert("Fill all fields"); return;}
  await addDoc(collection(db,"employees"),{name:empName.value,position:empPosition.value,salary:parseFloat(empSalary.value)});
  empName.value=""; empPosition.value=""; empSalary.value="";
  loadEmployees();
  employeeBox.classList.add("hidden");
  payrollBox.classList.remove("hidden");
});

// --- Load Employees ---
async function loadEmployees(){
  const snapshot = await getDocs(collection(db,"employees"));
  employees=[]; empSelect.innerHTML="";
  snapshot.forEach(doc=>{
    employees.push(doc.data());
    const option=document.createElement("option");
    option.value=doc.data().name;
    option.innerText=doc.data().name;
    empSelect.appendChild(option);
  });
}

// --- Add Payroll ---
addPayrollBtn.addEventListener("click", async ()=>{
  if(!grossPay.value || !deduction.value){ alert("Fill all fields"); return;}
  const net=parseFloat(grossPay.value)-parseFloat(deduction.value);
  await addDoc(collection(db,"payrolls"),{
    name:empSelect.value,
    month:monthSelect.value,
    gross:parseFloat(grossPay.value),
    deduction:parseFloat(deduction.value),
    net
  });
  grossPay.value=""; deduction.value="";
  loadPayrolls();
  payrollBox.classList.add("hidden");
  payslipBox.classList.remove("hidden");
});

// --- Load Payrolls ---
async function loadPayrolls(){
  const snapshot = await getDocs(collection(db,"payrolls"));
  payrolls=[]; payrollTable.innerHTML="";
  snapshot.forEach(doc=>{
    const p=doc.data(); payrolls.push(p);
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${p.name}</td><td>${p.month}</td><td>₱${p.gross.toFixed(2)}</td><td>₱${p.deduction.toFixed(2)}</td><td>₱${p.net.toFixed(2)}</td>
    <td><button onclick='generatePayslip(${JSON.stringify(p)})'>Payslip</button></td>`;
    payrollTable.appendChild(tr);
  });
}

// --- Generate Payslip ---
window.generatePayslip=(p)=>{
  const { jsPDF }=window.jspdf;
  const doc=new jsPDF();
  doc.text("Enterprise Payroll System",20,20);
  doc.text(`Name: ${p.name}`,20,40);
  doc.text(`Month: ${p.month}`,20,50);
  doc.text(`Gross: ₱${p.gross.toFixed(2)}`,20,60);
  doc.text(`Deduction: ₱${p.deduction.toFixed(2)}`,20,70);
  doc.text(`Net: ₱${p.net.toFixed(2)}`,20,80);
  doc.save(`Payslip_${p.name}_${p.month}.pdf`);
};
</script>

</body>
</html>
